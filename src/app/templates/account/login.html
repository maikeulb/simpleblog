{% extends "base.html" %}

{% block app_content %}
<main class="ui text container">

  <h2 class="ui header">
    <div class="content">
      Login
    </div>
  </h2>

  <form action="" method="post" class="ui form">
    <div class="ui segment">
      {{ form.hidden_tag() }}
        <div class="field">
          {{ form.username.label }}
          {{ form.username }}
        </div>
        <div class="field">
          {{ form.password.label }}
          {{ form.password }}
        </div>
        <div class="field">
          <div class="ui checkbox">
            {{ form.remember_me() }} {{ form.remember_me.label }}
          </div>
        </div>
        {{ form.submit(class="ui fluid large submit button") }}
        {% if form.errors %}
          <div class="ui negative message">
            <i class="close icon"></i>
            {% for error in form.password.errors %}
              <li>{{ error }}</li>
            {% endfor %}
            {% for error in form.username.errors %}
              <li>{{ error }}</li>
            {% endfor %}
          </div>
        {% endif%}
        {% if not form.errors %}
          <div class="ui error message"></div>
        {% endif%}
    </div>
  </form>

  <div class="ui center aligned container">
    <div class="ui message">
      New User? <a href="{{ url_for('account.register') }}"> Click to Register!</a>
   </div>
  </div>
  <div class="ui center aligned container">
    <div class="ui message">
      Forgot Your Password? <a href="{{
        url_for('account.reset_password_request') }}"> Click to Reset!</a>
   </div>
  </div>

    {% block js %}
  	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
  	<script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.14/semantic.min.js"></script>
    <script>
    $('.message .close')
      .on('click', function() {
        $(this)
          .closest('.message')
          .transition('fade')
        ;
      })
    ;
    $('.ui.form')
      .form({
        fields: {
          username: {
            identifier: 'username',
            rules     : [
               {
                  type  : 'empty',
                  prompt: 'Please enter you comment.'
               }
            ]
          }
        }
      })
      .api({
        url: '{{ url_for('main.process') }}',
        action       : 'new lead comment',
        method       : 'POST',
        serializeForm: true,
        urlData      : {
            id: $('#username').val()
        },
        onSuccess    : function(response) {
            alert('success');
            console.log(response);
        },
        onFailure    : function(response) {
            alert('failure');
            console.log(response);
        }
      })
    ;
    </script>
     {% endblock %}

</main>
{% endblock %}
